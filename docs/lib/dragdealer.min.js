!function(root,factory){"function"==typeof define&&define.amd?define(factory):"object"==typeof module&&module.exports?module.exports.Dragdealer=factory():root.Dragdealer=factory()}(this,function(){function Dragdealer(wrapper,options){this.options=this.applyDefaults(options||{}),this.bindMethods(),this.wrapper=this.getWrapperElement(wrapper),this.wrapper&&(this.handle=this.getHandleElement(this.wrapper,this.options.handleClass),this.handle&&(this.init(),this.bindEventListeners()))}Dragdealer.prototype={defaults:{disabled:!1,horizontal:!0,vertical:!1,slide:!0,steps:0,snap:!1,loose:!1,speed:.1,xPrecision:0,yPrecision:0,handleClass:"handle",css3:!0,activeClass:"active",tapping:!0},init:function(){var element;this.options.css3&&(element=this.handle,StylePrefix.backfaceVisibility&&StylePrefix.perspective&&(element.style[StylePrefix.perspective]="1000px",element.style[StylePrefix.backfaceVisibility]="hidden")),this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.dragStartPosition={x:0,y:0},this.change=[0,0],this.stepRatios=this.calculateStepRatios(),this.activity=!1,this.dragging=!1,this.tapping=!1,this.reflow(),this.options.disabled&&this.disable()},applyDefaults:function(options){for(var k in this.defaults)options.hasOwnProperty(k)||(options[k]=this.defaults[k]);return options},getWrapperElement:function(wrapper){return"string"==typeof wrapper?document.getElementById(wrapper):wrapper},getHandleElement:function(wrapper,handleClass){var childElements,handleClassMatcher,i;if(wrapper.getElementsByClassName){if(0<(childElements=wrapper.getElementsByClassName(handleClass)).length)return childElements[0]}else for(handleClassMatcher=new RegExp("(^|\\s)"+handleClass+"(\\s|$)"),childElements=wrapper.getElementsByTagName("*"),i=0;i<childElements.length;i++)if(handleClassMatcher.test(childElements[i].className))return childElements[i]},calculateStepRatios:function(){var stepRatios=[];if(1<=this.options.steps)for(var i=0;i<=this.options.steps-1;i++)1<this.options.steps?stepRatios[i]=i/(this.options.steps-1):stepRatios[i]=0;return stepRatios},setWrapperOffset:function(){this.offset.wrapper=Position.get(this.wrapper)},calculateBounds:function(){var bounds={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};return bounds.availWidth=bounds.right-bounds.left-this.handle.offsetWidth,bounds.availHeight=bounds.bottom-bounds.top-this.handle.offsetHeight,bounds},calculateValuePrecision:function(){var xPrecision=this.options.xPrecision||Math.abs(this.bounds.availWidth),yPrecision=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[xPrecision?1/xPrecision:0,yPrecision?1/yPrecision:0]},bindMethods:function(){"function"==typeof this.options.customRequestAnimationFrame?this.requestAnimationFrame=bind(this.options.customRequestAnimationFrame,window):this.requestAnimationFrame=bind(requestAnimationFrame,window),"function"==typeof this.options.customCancelAnimationFrame?this.cancelAnimationFrame=bind(this.options.customCancelAnimationFrame,window):this.cancelAnimationFrame=bind(cancelAnimationFrame,window),this.animateWithRequestAnimationFrame=bind(this.animateWithRequestAnimationFrame,this),this.animate=bind(this.animate,this),this.onHandleMouseDown=bind(this.onHandleMouseDown,this),this.onHandleTouchStart=bind(this.onHandleTouchStart,this),this.onDocumentMouseMove=bind(this.onDocumentMouseMove,this),this.onWrapperTouchMove=bind(this.onWrapperTouchMove,this),this.onWrapperMouseDown=bind(this.onWrapperMouseDown,this),this.onWrapperTouchStart=bind(this.onWrapperTouchStart,this),this.onDocumentMouseUp=bind(this.onDocumentMouseUp,this),this.onDocumentTouchEnd=bind(this.onDocumentTouchEnd,this),this.onHandleClick=bind(this.onHandleClick,this),this.onWindowResize=bind(this.onWindowResize,this)},bindEventListeners:function(){addEventListener(this.handle,"mousedown",this.onHandleMouseDown),addEventListener(this.handle,"touchstart",this.onHandleTouchStart),addEventListener(document,"mousemove",this.onDocumentMouseMove),addEventListener(this.wrapper,"touchmove",this.onWrapperTouchMove),addEventListener(this.wrapper,"mousedown",this.onWrapperMouseDown),addEventListener(this.wrapper,"touchstart",this.onWrapperTouchStart),addEventListener(document,"mouseup",this.onDocumentMouseUp),addEventListener(document,"touchend",this.onDocumentTouchEnd),addEventListener(this.handle,"click",this.onHandleClick),addEventListener(window,"resize",this.onWindowResize),this.animate(!1,!0),this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame)},unbindEventListeners:function(){removeEventListener(this.handle,"mousedown",this.onHandleMouseDown),removeEventListener(this.handle,"touchstart",this.onHandleTouchStart),removeEventListener(document,"mousemove",this.onDocumentMouseMove),removeEventListener(this.wrapper,"touchmove",this.onWrapperTouchMove),removeEventListener(this.wrapper,"mousedown",this.onWrapperMouseDown),removeEventListener(this.wrapper,"touchstart",this.onWrapperTouchStart),removeEventListener(document,"mouseup",this.onDocumentMouseUp),removeEventListener(document,"touchend",this.onDocumentTouchEnd),removeEventListener(this.handle,"click",this.onHandleClick),removeEventListener(window,"resize",this.onWindowResize),this.cancelAnimationFrame(this.interval)},onHandleMouseDown:function(e){Cursor.refresh(e),preventEventDefaults(e),stopEventPropagation(e),this.activity=!1,this.startDrag()},onHandleTouchStart:function(e){Cursor.refresh(e),stopEventPropagation(e),this.activity=!1,this.startDrag()},onDocumentMouseMove:function(e){e.clientX-this.dragStartPosition.x==0&&e.clientY-this.dragStartPosition.y==0||(Cursor.refresh(e),this.dragging&&(this.activity=!0,preventEventDefaults(e)))},onWrapperTouchMove:function(e){Cursor.refresh(e),this.activity||!this.draggingOnDisabledAxis()?(preventEventDefaults(e),this.activity=!0):this.dragging&&this.stopDrag()},onWrapperMouseDown:function(e){Cursor.refresh(e),preventEventDefaults(e),this.startTap()},onWrapperTouchStart:function(e){Cursor.refresh(e),preventEventDefaults(e),this.startTap()},onDocumentMouseUp:function(e){this.stopDrag(),this.stopTap()},onDocumentTouchEnd:function(e){this.stopDrag(),this.stopTap()},onHandleClick:function(e){this.activity&&(preventEventDefaults(e),stopEventPropagation(e))},onWindowResize:function(e){this.reflow()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset(),this.bounds=this.calculateBounds(),this.valuePrecision=this.calculateValuePrecision(),this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getStepWidth:function(){return Math.abs(this.bounds.availWidth/this.options.steps)},getValue:function(){return this.value.target},setStep:function(x,y,snap){this.setValue(this.options.steps&&1<x?(x-1)/(this.options.steps-1):0,this.options.steps&&1<y?(y-1)/(this.options.steps-1):0,snap)},setValue:function(x,y,snap){this.setTargetValue([x,y||0]),snap&&(this.groupCopy(this.value.current,this.value.target),this.updateOffsetFromValue(),this.callAnimationCallback())},startTap:function(){if(!this.disabled&&this.options.tapping)if(this.tapping=!0,this.setWrapperOffset(),this.options.snap&&this.options.steps){var cursorXRatio=(Cursor.x-this.offset.wrapper[0])/this.bounds.availWidth,cursorYRatio=(Cursor.y-this.offset.wrapper[1])/this.bounds.availHeight;this.setValue(this.getClosestStep(cursorXRatio),this.getClosestStep(cursorYRatio),!0)}else this.setTargetValueByOffset([Cursor.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,Cursor.y-this.offset.wrapper[1]-this.handle.offsetHeight/2])},stopTap:function(){!this.disabled&&this.tapping&&(this.tapping=!1,this.setTargetValue(this.value.current))},startDrag:function(){this.disabled||(this.dragging=!0,this.setWrapperOffset(),this.dragStartPosition={x:Cursor.x,y:Cursor.y},this.offset.mouse=[Cursor.x-Position.get(this.handle)[0],Cursor.y-Position.get(this.handle)[1]],this.wrapper.className.match(this.options.activeClass)||(this.wrapper.className+=" "+this.options.activeClass),this.callDragStartCallback())},stopDrag:function(){if(!this.disabled&&this.dragging){this.dragging=!1;var delta=[0===this.bounds.availWidth?0:(Cursor.x-this.dragStartPosition.x)/this.bounds.availWidth,0===this.bounds.availHeight?0:(Cursor.y-this.dragStartPosition.y)/this.bounds.availHeight],target=this.groupClone(this.value.current);if(this.options.slide){var ratioChange=this.change;target[0]+=4*ratioChange[0],target[1]+=4*ratioChange[1]}this.setTargetValue(target),this.wrapper.className=this.wrapper.className.replace(" "+this.options.activeClass,""),this.callDragStopCallback(delta)}},callAnimationCallback:function(){var value=this.value.current;this.options.snap&&1<this.options.steps&&(value=this.getClosestSteps(value)),this.groupCompare(value,this.value.prev)||("function"==typeof this.options.animationCallback&&this.options.animationCallback.call(this,value[0],value[1]),this.groupCopy(this.value.prev,value))},callTargetCallback:function(){"function"==typeof this.options.callback&&this.options.callback.call(this,this.value.target[0],this.value.target[1])},callDragStartCallback:function(){"function"==typeof this.options.dragStartCallback&&this.options.dragStartCallback.call(this,this.value.target[0],this.value.target[1])},callDragStopCallback:function(delta){"function"==typeof this.options.dragStopCallback&&this.options.dragStopCallback.call(this,this.value.target[0],this.value.target[1],delta)},animateWithRequestAnimationFrame:function(time){time?(this.timeOffset=this.timeStamp?time-this.timeStamp:0,this.timeStamp=time):this.timeOffset=25,this.animate(),this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame)},animate:function(direct,first){if(!direct||this.dragging){if(this.dragging){var prevTarget=this.groupClone(this.value.target),offset=[Cursor.x-this.offset.wrapper[0]-this.offset.mouse[0],Cursor.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(offset,this.options.loose),this.change=[this.value.target[0]-prevTarget[0],this.value.target[1]-prevTarget[1]]}(this.dragging||first)&&this.groupCopy(this.value.current,this.value.target),(this.dragging||this.glide()||first)&&(this.updateOffsetFromValue(),this.callAnimationCallback())}},glide:function(){var diff=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return!(!diff[0]&&!diff[1])&&(Math.abs(diff[0])>this.valuePrecision[0]||Math.abs(diff[1])>this.valuePrecision[1]?(this.value.current[0]+=diff[0]*Math.min(this.options.speed*this.timeOffset/25,1),this.value.current[1]+=diff[1]*Math.min(this.options.speed*this.timeOffset/25,1)):this.groupCopy(this.value.current,this.value.target),!0)},updateOffsetFromValue:function(){this.options.snap?this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current)):this.offset.current=this.getOffsetsByRatios(this.value.current),this.groupCompare(this.offset.current,this.offset.prev)||(this.renderHandlePosition(),this.groupCopy(this.offset.prev,this.offset.current))},renderHandlePosition:function(){var transform="";if(this.options.css3&&StylePrefix.transform)return this.options.horizontal&&(transform+="translateX("+this.offset.current[0]+"px)"),this.options.vertical&&(transform+=" translateY("+this.offset.current[1]+"px)"),void(this.handle.style[StylePrefix.transform]=transform);this.options.horizontal&&(this.handle.style.left=this.offset.current[0]+"px"),this.options.vertical&&(this.handle.style.top=this.offset.current[1]+"px")},setTargetValue:function(value,loose){var target=loose?this.getLooseValue(value):this.getProperValue(value);this.groupCopy(this.value.target,target),this.offset.target=this.getOffsetsByRatios(target),this.callTargetCallback()},setTargetValueByOffset:function(offset,loose){var value=this.getRatiosByOffsets(offset),target=loose?this.getLooseValue(value):this.getProperValue(value);this.groupCopy(this.value.target,target),this.offset.target=this.getOffsetsByRatios(target)},getLooseValue:function(value){var proper=this.getProperValue(value);return[proper[0]+(value[0]-proper[0])/4,proper[1]+(value[1]-proper[1])/4]},getProperValue:function(value){var proper=this.groupClone(value);return proper[0]=Math.max(proper[0],0),proper[1]=Math.max(proper[1],0),proper[0]=Math.min(proper[0],1),proper[1]=Math.min(proper[1],1),(!this.dragging&&!this.tapping||this.options.snap)&&1<this.options.steps&&(proper=this.getClosestSteps(proper)),proper},getRatiosByOffsets:function(group){return[this.getRatioByOffset(group[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(group[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(offset,range,padding){return range?(offset-padding)/range:0},getOffsetsByRatios:function(group){return[this.getOffsetByRatio(group[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(group[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(ratio,range,padding){return Math.round(ratio*range)+padding},getStepNumber:function(value){return this.getClosestStep(value)*(this.options.steps-1)+1},getClosestSteps:function(group){return[this.getClosestStep(group[0]),this.getClosestStep(group[1])]},getClosestStep:function(value){for(var k=0,min=1,i=0;i<=this.options.steps-1;i++)Math.abs(this.stepRatios[i]-value)<min&&(min=Math.abs(this.stepRatios[i]-value),k=i);return this.stepRatios[k]},groupCompare:function(a,b){return a[0]==b[0]&&a[1]==b[1]},groupCopy:function(a,b){a[0]=b[0],a[1]=b[1]},groupClone:function(a){return[a[0],a[1]]},draggingOnDisabledAxis:function(){return!this.options.horizontal&&Cursor.xDiff>Cursor.yDiff||!this.options.vertical&&Cursor.yDiff>Cursor.xDiff}};var bind=function(fn,context){return function(){return fn.apply(context,arguments)}},addEventListener=function(element,type,callback){element.addEventListener?element.addEventListener(type,callback,!1):element.attachEvent&&element.attachEvent("on"+type,callback)},removeEventListener=function(element,type,callback){element.removeEventListener?element.removeEventListener(type,callback,!1):element.detachEvent&&element.detachEvent("on"+type,callback)},preventEventDefaults=function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1},stopEventPropagation=function(e){(e=e||window.event).stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},Cursor={x:0,y:0,xDiff:0,yDiff:0,refresh:function(e){"mousemove"==(e=e||window.event).type?this.set(e):e.touches&&this.set(e.touches[0])},set:function(e){var lastX=this.x,lastY=this.y;e.clientX||e.clientY?(this.x=e.clientX,this.y=e.clientY):(e.pageX||e.pageY)&&(this.x=e.pageX-document.body.scrollLeft-document.documentElement.scrollLeft,this.y=e.pageY-document.body.scrollTop-document.documentElement.scrollTop),this.xDiff=Math.abs(this.x-lastX),this.yDiff=Math.abs(this.y-lastY)}},Position={get:function(obj){var rect={left:0,top:0};return void 0!==obj.getBoundingClientRect&&(rect=obj.getBoundingClientRect()),[rect.left,rect.top]}},StylePrefix={transform:getPrefixedStylePropName("transform"),perspective:getPrefixedStylePropName("perspective"),backfaceVisibility:getPrefixedStylePropName("backfaceVisibility")};function getPrefixedStylePropName(propName){var domPrefixes="Webkit Moz ms O".split(" "),elStyle=document.documentElement.style;if(void 0!==elStyle[propName])return propName;propName=propName.charAt(0).toUpperCase()+propName.substr(1);for(var i=0;i<domPrefixes.length;i++)if(void 0!==elStyle[domPrefixes[i]+propName])return domPrefixes[i]+propName}for(var vendors=["webkit","moz"],requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame,x=0;x<vendors.length&&!requestAnimationFrame;++x)requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];return requestAnimationFrame||(requestAnimationFrame=function(callback){return setTimeout(callback,25)},cancelAnimationFrame=clearTimeout),Dragdealer});